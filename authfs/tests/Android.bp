package {
    default_applicable_licenses: ["Android-Apache-2.0"],
}

java_test_host {
    name: "AuthFsHostTest",
    srcs: ["java/**/*.java"],
    libs: [
        "tradefed",
        "compatibility-tradefed",
        "compatibility-host-util",
    ],
    static_libs: [
        "VirtualizationTestHelper",
    ],
    test_suites: ["general-tests"],
    target_required: ["open_then_run_module"],
    data: [
        ":authfs_test_files",
        ":MicrodroidTestApp.signed",
    ],
}

rust_test {
    // PushFilePreparer can sometimes push the directory (if named "open_then_run", which contains
    // the actual executable in a per-architecture sub-directory) instead of the executable. This
    // makes it harder to use because the host Java test have to detect the executable path
    // dynamically, e.g. if it's a directory, append the device's architecture to build the actual
    // executable path. By simply renaming the module (thus the host directory), this forces
    // PushFilePreparer to always push the executable to the destination, so that the Java test can
    // easily locate the executable with a constant path.
    name: "open_then_run_module",
    stem: "open_then_run",

    crate_name: "open_then_run",
    srcs: ["open_then_run.rs"],
    edition: "2018",
    rustlibs: [
        "libandroid_logger",
        "libanyhow",
        "liblibc",
        "libclap",
        "libcommand_fds",
        "liblog_rust",
    ],
    test_suites: ["general-tests"],
    test_harness: false,
}
